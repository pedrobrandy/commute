<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shared Ride</title>
  <style>
    @font-face {
      font-family: 'UberMove';
      src: url('https://assets.uber.com/fonts/v2/UberMove-Medium.woff2') format('woff2');
      font-weight: 500;
      font-style: normal;
      font-display: swap;
    }

    @font-face {
      font-family: 'UberMoveText';
      src: url('https://assets.uber.com/fonts/v2/UberMoveText-Regular.woff2') format('woff2');
      font-weight: 400;
      font-style: normal;
      font-display: swap;
    }

    body {
      font-family: UberMove, UberMoveText, system-ui, "Helvetica Neue", Helvetica, Arial, sans-serif;
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Main layout container */
    .main-layout {
      display: grid;
      grid-template-columns: 2fr 1fr;
      width: 95%;
      min-height: 100vh;
      position: relative;
    }

    /* Background image section (2 columns) */
    .background-section {
      background-image: url('https://pedrobrandy.github.io/commute/image/ShareRidesImage.png');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-left: -31px;
    }

    /* Mobile background image */
    @media (max-width: 768px) {
      body {
        min-height: 100vh;
        height: 100vh;
        overflow: hidden;
        padding: 0;
        margin: 0;
      }

      .main-layout {
        height: auto;
        min-height: 100vh;
        width: 100%;
        overflow: hidden;
      }

      .background-section {
        background-image: url('image/MyShareRideMobile.png');
        background-size: cover;
        background-position: center;
      }
    }

    /* Form overlay on background image */
    .form-overlay {
      background: transparent;
      backdrop-filter: none;
      border-radius: 0;
      padding: 20px;
      box-shadow: none;
      max-width: 200px;
      width: 80%;
      margin: 0;
      position: absolute;
      bottom: 73px;
      left: 30px;
      z-index: 10;
    }

    /* Benefits section (1 column) */
    .benefits-section {
      background: #f8f9fa;
      padding: 40px 30px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      margin-right: -33px;
    }

    /* Benefits styling */
    .benefits-container {
      max-width: 600px;
      /* Increased from 350px for desktop */
    }

    .benefits-title {
      font-size: 24px;
      font-weight: 600;
      color: #1B263B;
      margin-bottom: 30px;
      text-align: center;
    }

    .benefits-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 25px;
    }

    .benefit-item {
      display: flex;
      align-items: flex-start;
      gap: 15px;
      padding: 0;
    }

    .benefit-icon {
      width: 133px;
      /* Keep large size on mobile */
      height: 100px;
      /* Keep large size on mobile */
      flex-shrink: 0;
      margin-top: 0;
    }

    .benefit-content {
      flex: 1;
    }

    .benefit-text {
      font-size: 16px;
      line-height: 1.5;
      color: #415A77;
      margin: 0;
    }

    .terms-link {
      display: inline-block;
      margin-top: 30px;
      color: #0078D4;
      text-decoration: none;
      font-weight: 500;
      font-size: 14px;
      text-align: center;
      width: 100%;
    }

    .terms-link:hover {
      text-decoration: underline;
    }

    /* Responsive design */
    @media (max-width: 1024px) {
      .main-layout {
        grid-template-columns: 1fr;
        grid-template-rows: auto auto;
      }

      .background-section {
        min-height: 400px;
        position: relative;
      }

      .form-overlay {
        position: absolute;
        bottom: 25px;
        left: 50%;
        transform: translateX(-50%);
        max-width: 220px;
      }

      .benefits-section {
        padding: 30px 20px;

      }

      .benefits-container {
        max-width: 100%;
      }
    }

    @media (max-width: 768px) {
      body {
        padding-top: 2px;
      }

      .main-layout {
        display: flex;
        flex-direction: column;
        gap: 0;
        height: auto;
        min-height: 100vh;
      }

      .ride-selector-buttons {
        position: static;
        justify-content: center;
        margin: 20px 0;
        gap: 15px;
        order: 1;
      }

      .background-section {
        min-height: 400px;
        order: 2;
        border-radius: 25px;
      }

      .form-overlay {
        max-width: 280px;
        padding: 20px;
        bottom: 10px;
        left: 50%;
        transform: translateX(-50%);
      }

      .benefits-section {
        padding: 20px 15px;
        order: 3;
        flex: 1;
        display: flex;
        align-items: flex-start;
        min-height: auto;
        margin-left: 10px;
      }

      .benefits-container {
        max-width: 100%;
        width: 100%;
      }

      .benefits-title {
        font-size: 20px;
        margin-bottom: 20px;
      }

      .benefits-list {
        gap: 15px;
      }

      .benefit-item {
        gap: 12px;
        align-items: flex-start;
      }

      .benefit-icon {
        width: 80px;
        height: 60px;
        margin-top: 0;
      }

      .benefit-text {
        font-size: 14px;
        line-height: 1.4;
      }

      .form-fields {
        gap: 15px;
      }

      .input-group {
        gap: 6px;
      }

      /* Specific styles for the date and time row on mobile */
      .input-group:first-child {
        display: flex !important;
        flex-direction: row !important;
        gap: 8px !important;
        align-items: stretch !important;
      }

      .input-group:first-child .input-with-icon {
        flex: 1 !important;
        min-width: 0 !important;
      }

      .input-group:first-child .input-with-icon input,
      .input-group:first-child .input-with-icon select {
        width: 100% !important;
        min-width: 0 !important;
        box-sizing: border-box !important;
      }

      .input-group label {
        font-size: 13px;
        font-weight: 600;
      }

      .input-group input,
      .input-group select {
        padding: 10px 10px 10px 40px;
        font-size: 16px;
        min-height: 50px;
        color: #666;
      }

      .input-icon {
        width: 18px;
        height: 18px;
        left: 10px;
      }

      button[type="submit"] {
        padding: 14px 24px;
        font-size: 16px;
        border-radius: 8px;
        min-height: 44px;
        font-weight: 600;
      }

      .benefits-title {
        font-size: 20px;
        margin-bottom: 20px;
      }

      .benefits-list {
        gap: 15px;
      }

      .benefit-text {
        font-size: 14px;
      }
    }

    .form-container {
      max-width: 500px;
      width: 100%;
      padding: 20px;
      border-radius: 12px;
      margin: 20px;
    }

    /* Adjust form elements for smaller size */
    .form-fields {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .input-group label {
      font-weight: 600;
      color: #1B263B;
      font-size: 12px;
    }

    .input-with-icon {
      position: relative;
      display: flex;
      align-items: center;
    }

    .input-icon {
      position: absolute;
      left: 12px;
      width: 18px;
      height: 18px;
      z-index: 2;
      filter: brightness(0) saturate(100%) invert(15%) sepia(15%) saturate(1034%) hue-rotate(202deg) brightness(95%) contrast(96%);
    }

    .input-group input,
    .input-group select {
      padding: 15px 15px 15px 40px;
      border: 2px solid white;
      border-radius: 6px;
      font-size: 16px;
      transition: border-color 0.3s ease;
      width: 100%;
      box-sizing: border-box;
      color: #666;
      background-color: white;
    }

    .input-group input::placeholder,
    .input-group select {
      color: #666;
      font-size: 16px;
    }

    .input-group select option {
      color: #666;
      font-size: 16px;
    }

    .input-group select option[value=""] {
      color: #666;
      font-style: normal;
    }

    .input-group input:focus,
    .input-group select:focus {
      outline: none;
      border-color: #778DA9;
    }

    .input-group input:invalid,
    .input-group select:invalid {
      outline: #778DA9;
      border-color: #E0E1DD;
    }

    /* Loading state for time select */
    .input-group select option[value=""] {
      color: #E0E1DD;
      outline: none;
      font-style: italic;
    }

    /* Success state for time select */
    .input-group select:not([value=""]) {
      border-color: white;
      outline: none;
    }

    button[type="submit"] {
      background-color: #0D1B2A;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    button[type="submit"]:hover {
      background-color: #E0E1DD;
      color: black;
    }

    button[type="submit"]:disabled {
      background-color: #E0E1DD;
      cursor: not-allowed;
    }

    /* Error message styling */
    .error-message {
      color: #dc3545;
      font-size: 14px;
      margin-top: 5px;
      display: none;
    }

    .error-message.show {
      display: block;
    }

    /* Loading indicator */
    .loading {
      opacity: 0.6;
      pointer-events: none;
    }

    /* Success indicator */
    .success {
      border-color: #28a745 !important;
      box-shadow: 0 0 0 0.2rem rgba(40, 167, 69, 0.25);
    }

    #summary,
    #sorryMessage {
      display: none;
      margin: 20px auto;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      font-size: 1rem;
      line-height: 1.4;
      width: 80%;
      max-width: 600px;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 10000;
    }

    #summaryContent {
      margin-bottom: 20px;
    }

    #map {
      width: 100%;
      height: 300px;
      margin-top: 20px;
      border: 1px solid #ccc;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    p.notice {
      margin-top: 20px;
      font-weight: bold;
      color: #cc0000;
    }

    #sorryMessage {
      background: #ffe6e6;
      color: #cc0000;
      text-align: center;
      font-weight: bold;
      font-size: 1.1rem;
    }

    @media (max-width: 600px) {

      .main-layout {
        grid-template-columns: 1fr;
        grid-template-rows: auto auto;
      }

      .background-section {
        min-height: 520px;
      }

      .form-overlay {
        margin: 2px;
        padding: 20px;
        max-width: 100%;
      }

      .benefits-section {
        padding: 20px 15px;
        margin-left: 10px;
      }

      .benefits-container {
        max-width: 100%;
      }

      .benefits-title {
        font-size: 18px;
        margin-bottom: 20px;
      }

      .benefits-list {
        gap: 15px;
      }

      .benefit-text {
        font-size: 14px;
      }

      #summary,
      #sorryMessage {
        width: 95%;
        margin: 10px;
        padding: 15px;
      }
    }

    #preconfirmControls {
      margin-top: 20px;
      text-align: center;
    }

    .confirm-button {
      display: inline-block;
      margin-right: 10px;
      padding: 12px 0;
      font-size: 1rem;
      text-align: center;
      width: 100%;
      margin-top: 10px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      color: white;
      text-decoration: none;
      transition: background-color 0.3s ease;
    }

    .confirm {
      background-color: #1add1a;
    }

    .confirm:hover {
      background-color: #17b817;
    }

    .not-accept {
      background-color: #ca1313;
    }

    .not-accept:hover {
      background-color: #a01010;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 10px;
      position: relative;
    }

    .user-info span {
      color: #333;
    }

    .logout-btn {
      background: none;
      border: none;
      color: #0078D4;
      cursor: pointer;
      font-weight: 600;
      padding: 5px 10px;
      border-radius: 4px;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .logout-btn:hover {
      background-color: #f0f0f0;
    }

    .user-icon {
      display: none;
      font-size: 1.2rem;
      color: #0078D4;
      cursor: pointer;
      padding: 5px;
      border-radius: 50%;
      transition: background-color 0.3s;
    }

    .user-icon:hover {
      background-color: #f0f0f0;
    }

    /* Calendar Styles */
    .calendar-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: white;
      border: 1px solid #E0E1DD;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      z-index: 1000;
      display: none;
      margin-top: 4px;
      padding: 12px;
      min-width: 220px;
      max-width: 240px;
      font-size: 11px;
    }

    .calendar-dropdown.show {
      display: block;
    }

    .calendar-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .calendar-nav {
      background: none;
      border: none;
      cursor: pointer;
      padding: 6px;
      border-radius: 4px;
      color: #1B263B;
      transition: background-color 0.2s;
      font-size: 11px;
    }

    .calendar-nav:hover:not(:disabled) {
      background-color: #f8f9fa;
    }

    .calendar-nav:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .calendar-title {
      font-weight: 600;
      color: #1B263B;
      font-size: 12px;
    }

    .calendar-weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 3px;
      margin-bottom: 8px;
    }

    .calendar-weekdays div {
      text-align: center;
      font-size: 10px;
      color: #6c757d;
      font-weight: 500;
      padding: 6px 2px;
    }

    .calendar-days {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 3px;
    }

    .calendar-day {
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      cursor: pointer;
      font-size: 11px;
      color: #1B263B;
      transition: all 0.2s;
      border: none;
      background: none;
      padding: 3px;
      min-height: 28px;
    }

    .calendar-day:hover:not(.disabled):not(.selected) {
      background-color: #f8f9fa;
    }

    .calendar-day.disabled {
      color: #adb5bd;
      cursor: not-allowed;
    }

    .calendar-day.selected {
      background-color: #1B263B;
      color: white;
    }

    .calendar-day.today {
      border: 2px solid #1B263B;
    }

    .calendar-day.other-month {
      color: #adb5bd;
    }

    /* Responsive calendar styles */
    @media (max-width: 768px) {
      .calendar-dropdown {
        min-width: 200px;
        max-width: 220px;
        padding: 8px;
        margin-top: 2px;
        font-size: 10px;
      }

      .calendar-header {
        margin-bottom: 8px;
      }

      .calendar-nav {
        padding: 4px;
        font-size: 10px;
      }

      .calendar-title {
        font-size: 11px;
      }

      .calendar-weekdays div {
        font-size: 9px;
        padding: 4px 1px;
      }

      .calendar-day {
        font-size: 10px;
        padding: 2px;
        min-height: 24px;
      }
    }

    @media (max-width: 480px) {
      .calendar-dropdown {
        min-width: 180px;
        max-width: 200px;
        padding: 6px;
        left: -10px;
        right: -10px;
        font-size: 9px;
      }

      .calendar-header {
        margin-bottom: 6px;
      }

      .calendar-nav {
        padding: 3px;
        font-size: 9px;
      }

      .calendar-title {
        font-size: 10px;
      }

      .calendar-weekdays div {
        font-size: 8px;
        padding: 3px 1px;
      }

      .calendar-day {
        font-size: 9px;
        padding: 1px;
        min-height: 20px;
      }
    }

    /* Ride selector buttons - Top Left */
    .ride-selector-buttons {
      position: absolute;
      top: 30px;
      left: 30px;
      display: flex;
      gap: 15px;
      z-index: 1000;
    }

    .ride-option {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 10px 20px;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid #E0E1DD;
      background: white;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .ride-option:hover {
      background-color: #f8f9fa;
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
    }

    .ride-option span {
      font-weight: 600;
      color: #495057;
      font-size: 14px;
      text-align: center;
    }

    .ride-option.active {
      background-color: #0D1B2A;
      border-color: #0D1B2A;
      box-shadow: 0 4px 12px rgba(13, 27, 42, 0.3);
    }

    .ride-option.active span {
      color: white;
    }

    /* Responsive design for buttons */
    @media (max-width: 768px) {
      .ride-selector-buttons {
        position: static;
        justify-content: center;
        margin: 20px 0;
        gap: 15px;
      }

      .ride-option {
        padding: 13px 57px;
      }

      .ride-option span {
        font-size: 14px;
      }
    }

    @media (max-width: 480px) {
      .ride-selector-buttons {
        margin: 15px 0;
        gap: 12px;
      }

      .ride-option {
        padding: 13px 57px;
      }

      .ride-option span {
        font-size: 14px;
      }
    }

    /* iPhone compatibility for time inputs */
    input[type="time"] {
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      background: white;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      padding: 12px 14px;
      font-size: 16px;
      /* Prevents zoom on iPhone */
      font-family: UberMove, UberMoveText, system-ui, "Helvetica Neue", Helvetica, Arial, sans-serif;
      color: #adb5bd;
      width: 100%;
      box-sizing: border-box;
      transition: all 0.3s ease;
    }

    input[type="time"]:focus {
      outline: none;
      border-color: #0D1B2A;
      box-shadow: 0 0 0 3px rgba(13, 27, 42, 0.1);
    }

    /* iPhone Safari specific styles */
    @supports (-webkit-touch-callout: none) {
      input[type="time"] {
        -webkit-appearance: none;
        background: white;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        padding: 12px 14px;
        font-size: 16px;
        min-height: 44px;
        /* Minimum touch target size for iOS */
      }

      input[type="time"]::-webkit-datetime-edit {
        padding: 0;
        color: #E0E1DD;
      }

      input[type="time"]::-webkit-datetime-edit-fields-wrapper {
        padding: 0;
      }

      input[type="time"]::-webkit-datetime-edit-text {
        padding: 0 2px;
        color: #666;
      }

      input[type="time"]::-webkit-datetime-edit-hour-field,
      input[type="time"]::-webkit-datetime-edit-minute-field {
        padding: 0 2px;
        color: grey;
      }

      input[type="time"]::-webkit-calendar-picker-indicator {
        background: transparent;
        color: transparent;
        cursor: pointer;
        height: 20px;
        width: 20px;
        margin-left: 5px;
      }
    }

    /* Fallback for older browsers */
    input[type="time"]::-webkit-inner-spin-button,
    input[type="time"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    input[type="time"]::-webkit-calendar-picker-indicator {
      background: transparent;
      color: transparent;
      cursor: pointer;
      height: 20px;
      width: 20px;
      margin-left: 5px;
    }

    /* iPhone compatibility for select fields */
    select {
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      background: white;
      border: 2px solid #E0E1DD;
      border-radius: 8px;
      padding: 12px 14px;
      font-size: 16px;
      /* Prevents zoom on iPhone */
      font-family: UberMove, UberMoveText, system-ui, "Helvetica Neue", Helvetica, Arial, sans-serif;
      color: #1B263B !important;
      /* Force black color for iPhone */
      width: 100%;
      box-sizing: border-box;
      transition: all 0.3s ease;
      text-align: right;
    }

    select:focus {
      outline: none;
      border-color: #0D1B2A;
      box-shadow: 0 0 0 3px rgba(13, 27, 42, 0.1);
    }

    /* iPhone Safari specific styles for select */
    @supports (-webkit-touch-callout: none) {
      select {
        -webkit-appearance: none;
        background: white;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        padding: 12px 14px;
        font-size: 16px;
        min-height: 44px;
        /* Minimum touch target size for iOS */
        color: #000 !important;
        text-align: right;
      }

      select option {
        color: #000;
        background: white;
      }
    }

    /* Fallback for older browsers */
    select::-ms-expand {
      display: none;
    }

    /* iPhone specific optimizations */
    @media (max-width: 480px) {
      body {
        min-height: 100vh;
        height: auto;
        /* Allow natural height */
        overflow-x: hidden;
        padding: 0;
        margin: 0;
      }

      .main-layout {
        height: auto;
        /* Allow natural height */
        min-height: 100vh;
        width: 100%;
        overflow: hidden;
      }

      .background-section {
        min-height: 397px;
        /* Even smaller for iPhone */
        margin-left: 0px
      }

      .benefits-section {
        padding: 15px 10px;
        flex: 1;
        display: flex;
        align-items: flex-start;
        min-height: auto;
        margin-right: 3px;
      }

      .benefits-title {
        font-size: 18px;
        margin-bottom: 15px;
      }

      .benefits-list {
        gap: 12px;
      }

      .benefit-item {
        gap: 10px;
        align-items: flex-start;
      }

      .benefit-icon {
        width: 70px;
        /* Even smaller for iPhone */
        height: 53px;
        margin-top: 0;
      }

      .benefit-text {
        font-size: 13px;
        line-height: 1.3;
      }

      .form-overlay {
        max-width: 320px;
        padding: 25px;
        bottom: -1px;
      }

      .input-group input,
      .input-group select {
        padding: 10px 10px 10px 40px;
        font-size: 16px;
        min-height: 50px;
        color: #666;
      }

      .input-icon {
        width: 20px;
        height: 20px;
        left: 12px;
      }

      .input-group label {
        font-size: 14px;
      }

      button[type="submit"] {
        padding: 16px 28px;
        font-size: 18px;
        min-height: 50px;
      }

      .form-fields {
        gap: 8px;
      }

      .input-group {
        gap: 8px;
      }
    }

    /* Additional mobile-specific styles for better iPhone compatibility */
    @media (max-width: 480px) {
      .form-overlay {
        max-width: 320px;
        padding: 15px;
        bottom: 15px;
      }

      .input-group.location-row {
        gap: 6px !important;
      }

      .input-group.location-row .input-with-icon input {
        font-size: 16px !important;
        padding: 10px 10px 10px 30px !important;
        min-height: 40px !important;
        color: #666 !important;
      }

      .input-group.location-row .input-icon {
        width: 18px !important;
        height: 18px !important;
        left: 8px !important;
      }
    }

    /* Ensure proper touch targets for iOS */
    @media (max-width: 768px) {

      .input-group input,
      .input-group select,
      button[type="submit"] {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        border-radius: 8px;
        min-height: 44px;
        /* iOS recommended minimum touch target */
      }

      .input-group select {
        background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23666%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.4-12.8z%22/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 8px center;
        background-size: 12px auto;
        padding-right: 30px;
        color: #666;
      }
    }

    /* Location row specific styles */
    .location-row {
      display: flex;
      gap: 10px;
      align-items: stretch;
    }

    .location-row .input-with-icon {
      flex: 1;
      min-width: 0;
    }

    .location-row .input-with-icon input {
      width: 100%;
      min-width: 0;
      box-sizing: border-box;
    }

    /* Ensure proper mobile layout */
    @media (max-width: 768px) {
      .location-row {
        gap: 8px;
      }
    }

    @media (max-width: 480px) {
      .location-row {
        gap: 6px;
      }
    }

    /* Specific styles for the location row on mobile */
    .input-group.location-row {
      display: flex !important;
      flex-direction: row !important;
      gap: 8px !important;
      align-items: stretch !important;
    }

    .input-group.location-row .input-with-icon {
      flex: 1 !important;
      min-width: 0 !important;
    }

    .input-group.location-row .input-with-icon input {
      width: 100% !important;
      min-width: 0 !important;
      box-sizing: border-box !important;
    }
  </style>

</head>

<body>
  <!-- Main 3-column layout -->
  <div class="main-layout">
    <!-- Ride selector buttons - Top Left (Desktop) / Centered (Mobile) -->
    <div class="ride-selector-buttons">
      <div class="ride-option active" id="sharedOption">
        <span>Shared</span>
      </div>
      <div class="ride-option" id="personalOption" onclick="window.location.href='Personal Ride.html'">
        <span>Personal</span>
      </div>
    </div>

    <!-- Background image section (2 columns) -->
    <div class="background-section">
      <div class="form-overlay">
        <form id="sharedRideForm" class="ride-form">
          <div class="form-fields">
            <!-- First line: DATE only -->
            <div class="input-group">
              <div class="input-with-icon">
                <img src="https://www.svgrepo.com/show/438428/date-round.svg" alt="Date" class="input-icon">
                <input type="text" id="startDate" placeholder="Date" readonly required />
                <div class="calendar-dropdown" id="calendarDropdown">
                  <div class="calendar-header">
                    <button class="calendar-nav" id="prevMonth" disabled>
                      <svg viewBox="0 0 24 24" width="16" height="16">
                        <path fill-rule="evenodd" clip-rule="evenodd"
                          d="M9 12C9 12.2652 9.10536 12.5196 9.29289 12.7071L13.2929 16.7071C13.6834 17.0976 14.3166 17.0976 14.7071 16.7071C15.0976 16.3166 15.0976 15.6834 14.7071 15.2929L11.4142 12L14.7071 8.70711C15.0976 8.31658 15.0976 7.68342 14.7071 7.29289C14.3166 6.90237 13.6834 6.90237 13.2929 7.29289L9.29289 11.2929C9.10536 11.4804 9 11.7348 9 12Z">
                        </path>
                      </svg>
                    </button>
                    <div class="calendar-title">
                      <span id="currentMonth">June</span>
                      <span id="currentYear">2025</span>
                    </div>
                    <button class="calendar-nav" id="nextMonth">
                      <svg viewBox="0 0 24 24" width="16" height="16">
                        <path fill-rule="evenodd" clip-rule="evenodd"
                          d="M9.29289 7.29289C8.90237 7.68342 8.90237 8.31658 9.29289 8.70711L12.5858 12L9.29289 15.2929C8.90237 15.6834 8.90237 16.3166 9.29289 16.7071C9.68342 17.0976 10.3166 17.0976 10.7071 16.7071L14.7071 12.7071C14.8946 12.5196 15 12.2652 15 12C15 11.7348 14.8946 11.4804 14.7071 11.2929L10.7071 7.29289C10.3166 6.90237 9.68342 6.90237 9.29289 7.29289Z">
                        </path>
                      </svg>
                    </button>
                  </div>
                  <div class="calendar-weekdays">
                    <div>Su</div>
                    <div>Mo</div>
                    <div>Tu</div>
                    <div>We</div>
                    <div>Th</div>
                    <div>Fr</div>
                    <div>Sa</div>
                  </div>
                  <div class="calendar-days" id="calendarDays"></div>
                </div>
              </div>
            </div>

            <!-- Second line: Pickup and Drop-off Location -->
            <div class="input-group location-row">
              <div class="input-with-icon pickup-field">
                <img src="https://www.iconpacks.net/icons/2/free-location-icon-2955-thumb.png" alt="Location"
                  class="input-icon">
                <input type="text" id="pickup" placeholder="Pickup Location" required />
              </div>

              <div class="input-with-icon dropoff-field">
                <img src="https://www.iconpacks.net/icons/2/free-location-icon-2955-thumb.png" alt="Location"
                  class="input-icon">
                <input type="text" id="dropoff" placeholder="Drop-off Location" required />
              </div>
            </div>

            <!-- Third line: Trip Start Time -->
            <div class="input-group">
              <div class="input-with-icon">
                <img
                  src="https://static.vecteezy.com/system/resources/previews/017/259/098/non_2x/clock-icon-time-sign-free-png.png"
                  alt="Time" class="input-icon">
                <select id="time" required>
                  <option value="">Trip Start Time (to First Stop)</option>
                </select>
              </div>
            </div>

            <!-- Fourth line: Submit Button -->
            <button type="submit">Submit</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Benefits section (1 column) -->
    <div class="benefits-section">
      <div class="benefits-container">
        <h3 class="benefits-title">How it work?</h3>
        <ul class="benefits-list">
          <li class="benefit-item"
            aria-label="Step 1: Tell us your route and hang tight — we'll match you with others going your way">
            <div class="benefit-icon">
              <img alt="" src="../../public/image/Step1Commute.png" class="benefit-icon">
            </div>
            <div class="benefit-content">
              <div>
                <p class="benefit-text">Step 1: Tell us your route and hang tight — we'll match you with others going
                  your way.</p>
              </div>
            </div>
          </li>
          <li class="benefit-item"
            aria-label="Step 2: Once the ride is full, confirm your estimated arrival time. Not a good fit? You can cancel up to 90 minutes before. Otherwise, welcome aboard!">
            <div class="benefit-icon">
              <img alt="" src="../../public/image/Step2Commute.png" class="benefit-icon">
            </div>
            <div class="benefit-content">
              <div>
                <p class="benefit-text">Step 2: Once the ride is full, confirm your estimated arrival time. Not a good
                  fit? You can cancel up to 90 minutes before. Otherwise, welcome aboard!</p>
              </div>
            </div>
          </li>
          <li class="benefit-item"
            aria-label="Step 3: Got a long ride? Pick your favorite music vibe and share some tunes with fellow riders.">
            <div class="benefit-icon">
              <img alt="" src="../../public/image/Step3Commute.png" class="benefit-icon">
            </div>
            <div class="benefit-content">
              <div>
                <p class="benefit-text">Step 3: Got a long ride? Pick your favorite music vibe and share some tunes with
                  fellow riders.</p>
              </div>
            </div>
          </li>
          <li class="benefit-item"
            aria-label="Step 4: Arrive at work or home on time, comfortably and stress-free — no last-minute cancellations, just good company and smooth travels.">
            <div class="benefit-icon">
              <img alt="" src="../../public/image/Step4Commute.png" class="benefit-icon">
            </div>
            <div class="benefit-content">
              <div>
                <p class="benefit-text">Step 4: Arrive at work or home on time, comfortably and stress-free — no
                  last-minute cancellations, just good company and smooth travels.</p>
              </div>
            </div>
          </li>
        </ul>
        <a aria-label="" href="https://www.uber.com/ca/en/ride/how-it-works/reserve/#see-prices" target="_self"
          class="terms-link">See terms</a>
      </div>
    </div>
  </div>

  <!-- Summary and error messages -->
  <div id="summary" style="display: none;">
    <div id="summaryContent"></div>
    <div id="map"></div>
    <div id="preconfirmControls">
      <button class="confirm-button confirm" onclick="confirmReservation()">Confirm</button>
      <button class="confirm-button not-accept" onclick="notAcceptReservation()">Not Accept</button>
    </div>
  </div>

  <div id="sorryMessage" style="display: none;">
    <p>Sorry, this route is not available for shared rides. Please try a different route or contact us for assistance.
    </p>
  </div>

  <script src="../scripts/google-maps-utils.js"></script>
  <script src="../scripts/auth.js"></script>
  <script src="../config/config.production.js"></script>
  <script>
    let directionsService, directionsRenderer;
    const additionalMinutes = 10;
    let googleMapsUtils;

    async function initMap() {
      console.log('Initializing Google Maps...');

      try {
        // Initialize Google Maps utilities
        googleMapsUtils = new GoogleMapsUtils(CONFIG.GOOGLE_MAPS_API_KEY);
        await googleMapsUtils.init();

        // Initialize directions service
        const directions = googleMapsUtils.initDirectionsService();
        if (directions) {
          directionsService = directions.directionsService;
          directionsRenderer = directions.directionsRenderer;
        }

        // Initialize autocomplete for pickup and dropoff
        const pickupInput = document.getElementById("pickup");
        const dropoffInput = document.getElementById("dropoff");

        if (pickupInput) {
          googleMapsUtils.initAutocomplete(pickupInput);
        }

        if (dropoffInput) {
          googleMapsUtils.initAutocomplete(dropoffInput);
        }

        console.log('Google Maps initialized successfully');
      } catch (error) {
        console.error('Error initializing Google Maps:', error);
      }
    }

    function getRouteInfo(origin, destination, travelMode) {
      return new Promise((resolve, reject) => {
        directionsService.route(
          {
            origin,
            destination,
            travelMode,
          },
          (response, status) => {
            if (status === "OK") {
              const leg = response.routes[0].legs[0];
              resolve({
                distanceText: leg.distance.text,
                distanceValue: leg.distance.value,
                durationValue: leg.duration.value,
                durationText: leg.duration.text,
              });
            } else {
              reject("Directions request failed due to " + status);
            }
          }
        );
      });
    }

    function calculatePrice(distanceKm) {
      if (distanceKm >= 100) return 25;
      if (distanceKm >= 80) return 20;
      if (distanceKm >= 35) return 15;
      return 0;
    }

    function convertTimeToHHMMSS(timeStr) {
      // Handle undefined or empty time strings
      if (!timeStr || typeof timeStr !== 'string') {
        console.warn('Invalid time string:', timeStr);
        return "00:00:00";
      }

      // Handle 24-hour format (e.g., "14:30")
      const time24Match = timeStr.match(/^([0-1]?[0-9]|2[0-3]):([0-5][0-9])$/);
      if (time24Match) {
        const hours = time24Match[1].padStart(2, '0');
        const minutes = time24Match[2];
        return `${hours}:${minutes}:00`;
      }

      // Handle 12-hour format (e.g., "530am", "1pm", "9pm")
      const match = timeStr.match(/(\d{1,2})(\d{2})?(am|pm)/i);
      if (match) {
        let hours = parseInt(match[1]);
        let minutes = match[2] || "00";

        // Convert to 24-hour format
        if (match[3].toLowerCase() === 'pm' && hours !== 12) {
          hours += 12;
        } else if (match[3].toLowerCase() === 'am' && hours === 12) {
          hours = 0;
        }

        return `${hours.toString().padStart(2, '0')}:${minutes}:00`;
      }

      console.warn('Time string format not recognized:', timeStr);
      return "00:00:00";
    }

    // Function to determine if a location is in KWC area
    function isKWCLocation(location) {
      const kwcKeywords = [
        'kitchener', 'waterloo', 'cambridge', 'guelph', 'guelp', 'kwc', 'kw',
        'conestoga', 'university of waterloo', 'wilfrid laurier',
        'fairview park', 'boardwalk', 'laurier', 'uwaterloo',
        'prospect avenue', 'prospect ave', 'prospect av', 'prospect',
        'kitchener ontario', 'waterloo ontario', 'cambridge ontario', 'guelph ontario',
        'imperial road', 'imperial rd', 'imperial'
      ];

      const locationLower = location.toLowerCase();
      return kwcKeywords.some(keyword => locationLower.includes(keyword));
    }

    // Function to determine if a location is in Toronto/Mississauga area
    function isTorontoMississaugaLocation(location) {
      const torontoKeywords = [
        'toronto', 'mississauga', 'pearson', 'airport', 'downtown toronto',
        'scarborough', 'etobicoke', 'north york', 'york', 'east york',
        'brampton', 'oakville', 'burlington', 'milton', 'vaughan',
        'markham', 'richmond hill', 'aurora', 'newmarket',
        'union station', 'front street', 'front st', 'front',
        'toronto ontario', 'mississauga ontario', 'pearson airport', 'yyz',
        'cibc square', 'cibc', 'bay street', 'bay st', 'bay',
        'silver dart drive', 'silver dart'
      ];

      const locationLower = location.toLowerCase();
      return torontoKeywords.some(keyword => locationLower.includes(keyword));
    }

    // Function to determine trip direction based on pickup and dropoff
    function determineTripDirection(pickup, dropoff) {
      const pickupIsKWC = isKWCLocation(pickup);
      const dropoffIsKWC = isKWCLocation(dropoff);
      const pickupIsToronto = isTorontoMississaugaLocation(pickup);
      const dropoffIsToronto = isTorontoMississaugaLocation(dropoff);

      if (pickupIsKWC && dropoffIsToronto) {
        return {
          direction: 'kwc-t',
          directionText: 'KWC → Mississauga / Toronto',
          availableTimes: [
            { value: "530am", label: "5:30 AM" },
            { value: "1pm", label: "1:00 PM" },
            { value: "9pm", label: "9:00 PM" }
          ]
        };
      } else if (pickupIsToronto && dropoffIsKWC) {
        return {
          direction: 't-kwc',
          directionText: 'Mississauga / Toronto → KWC',
          availableTimes: [
            { value: "10am", label: "10:00 AM" },
            { value: "4pm", label: "4:00 PM" },
            { value: "11pm", label: "11:00 PM" }
          ]
        };
      } else {
        return null; // Invalid route
      }
    }

    // Function to update time selection based on direction
    function updateTimeSelection(direction) {
      const timeSelect = document.getElementById('time');
      if (!timeSelect) return;

      // Clear previous options
      timeSelect.innerHTML = '<option value="">Trip Start Time (to First Stop)</option>';

      if (direction && direction.availableTimes) {
        direction.availableTimes.forEach(time => {
          const option = document.createElement('option');
          option.value = time.value;
          option.textContent = time.label;
          timeSelect.appendChild(option);
        });

        // Add visual feedback for successful detection
        timeSelect.classList.add('success');

        // Remove success class after a delay
        setTimeout(() => {
          timeSelect.classList.remove('success');
        }, 2000);
      }
    }

    document.getElementById("sharedRideForm").addEventListener("submit", async function (e) {
      e.preventDefault();

      const user = JSON.parse(localStorage.getItem('user'));
      if (!user) {
        window.location.href = 'login.html';
        return;
      }

      const origin = document.getElementById("pickup").value;
      const destination = document.getElementById("dropoff").value;

      // Determine trip direction automatically
      const tripDirection = determineTripDirection(origin, destination);
      if (!tripDirection) {
        alert('Invalid route. Please ensure one location is in KWC area and the other is in Toronto/Mississauga area.');
        return;
      }

      const timeSelect = document.getElementById("time");
      const selectedTime = timeSelect.value;
      if (!selectedTime) {
        alert('Please select a time for your trip.');
        return;
      }

      try {
        const drivingInfo = await getRouteInfo(origin, destination, google.maps.TravelMode.DRIVING);
        const transitInfo = await getRouteInfo(origin, destination, google.maps.TravelMode.TRANSIT);

        const distanceKm = drivingInfo.distanceValue / 1000;
        const price = calculatePrice(distanceKm);

        if (distanceKm < 35) {
          this.style.display = "none";
          document.getElementById("summary").style.display = "none";
          document.getElementById("sorryMessage").style.display = "block";
          return;
        }

        const adjustedDrivingSeconds = drivingInfo.durationValue + additionalMinutes * 60;
        const adjustedHours = Math.floor(adjustedDrivingSeconds / 3600);
        const adjustedMinutes = Math.round((adjustedDrivingSeconds % 3600) / 60);
        const adjustedTimeFormatted = `${adjustedHours > 0 ? adjustedHours + 'hour(s) ' : ''}${adjustedMinutes}min`;

        const startDate = document.getElementById("startDate").value;
        const timeValue = convertTimeToHHMMSS(selectedTime);

        // Prepare reservation data
        const reservationData = {
          type: "Shared Ride",
          name: user.fullName,
          phone: user.phone,
          email: user.email,
          origin: origin,
          destination: destination,
          directionText: tripDirection.directionText,
          timeText: selectedTime,
          timeValue: timeValue,
          startDate: startDate,
          endDate: "-",
          distanceText: drivingInfo.distanceText,
          ETAY: "-",
          price: price,
          adjustedDrivingMinutes: adjustedTimeFormatted,
          adjustedDrivingDuration: adjustedTimeFormatted,
          transitDurationText: transitInfo.durationText,
          estimatedArrivalTime: "-"
        };

        // Send to Google Sheets
        try {
          const formData = new URLSearchParams();
          formData.append('action', 'saveReservation');
          formData.append('type', 'Shared Ride');
          formData.append('status', 'Negociación');
          formData.append('name', user.fullName);
          formData.append('phone', user.phone);
          formData.append('email', user.email);
          formData.append('origin', origin);
          formData.append('destination', destination);
          formData.append('directionText', tripDirection.directionText);
          formData.append('timeText', selectedTime);
          formData.append('timeValue', timeValue);
          formData.append('startDate', startDate);
          formData.append('endDate', "-");
          formData.append('distanceText', drivingInfo.distanceText);
          formData.append('ETAY', "-");
          formData.append('price', price);
          formData.append('adjustedDrivingMinutes', adjustedTimeFormatted);
          formData.append('adjustedDrivingDuration', adjustedTimeFormatted);
          formData.append('transitDurationText', transitInfo.durationText);
          formData.append('estimatedArrivalTime', "-");

          const response = await fetch(CONFIG.GOOGLE_APPS_SCRIPT.SHARED_RIDE, {
            method: 'POST',
            mode: 'no-cors',
            headers: {
              'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: formData.toString()
          });

          // Redirect to summary page with data
          const encodedData = encodeURIComponent(JSON.stringify(reservationData));
          window.parent.postMessage({
            type: 'LOAD_SUMMARY',
            data: encodedData
          }, window.location.origin);

        } catch (error) {
          console.error('Error:', error);
          alert('An error occurred while submitting the reservation. Please try again.');
        }

      } catch (error) {
        console.error(error);
      }
    });

    // Initialize map on page load
    document.addEventListener('DOMContentLoaded', function () {
      initMap();
    });

    // Also initialize when window loads (fallback)
    window.addEventListener('load', function () {
      if (!googleMapsUtils) {
        initMap();
      }
    });

    // Add event listeners for pickup and dropoff changes
    document.addEventListener('DOMContentLoaded', function () {
      const pickupInput = document.getElementById('pickup');
      const dropoffInput = document.getElementById('dropoff');
      const timeSelect = document.getElementById('time');
      const dateInput = document.getElementById('startDate');
      const calendarDropdown = document.getElementById('calendarDropdown');

      // Calendar functionality
      let currentDate = new Date();
      let selectedDate = null;

      // Initialize calendar
      function initCalendar() {
        updateCalendar();

        // Show calendar when clicking on date input
        dateInput.addEventListener('click', function () {
          calendarDropdown.classList.toggle('show');
        });

        // Hide calendar when clicking outside
        document.addEventListener('click', function (e) {
          if (!dateInput.contains(e.target) && !calendarDropdown.contains(e.target)) {
            calendarDropdown.classList.remove('show');
          }
        });

        // Navigation buttons
        document.getElementById('prevMonth').addEventListener('click', function () {
          currentDate.setMonth(currentDate.getMonth() - 1);
          updateCalendar();
        });

        document.getElementById('nextMonth').addEventListener('click', function () {
          currentDate.setMonth(currentDate.getMonth() + 1);
          updateCalendar();
        });
      }

      function updateCalendar() {
        const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
          'July', 'August', 'September', 'October', 'November', 'December'];

        document.getElementById('currentMonth').textContent = monthNames[currentDate.getMonth()];
        document.getElementById('currentYear').textContent = currentDate.getFullYear();

        const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
        const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
        const startDate = new Date(firstDay);
        startDate.setDate(startDate.getDate() - firstDay.getDay());

        const calendarDays = document.getElementById('calendarDays');
        calendarDays.innerHTML = '';

        const today = new Date();
        today.setHours(0, 0, 0, 0);

        for (let i = 0; i < 42; i++) {
          const date = new Date(startDate);
          date.setDate(startDate.getDate() + i);

          const dayButton = document.createElement('button');
          dayButton.className = 'calendar-day';
          dayButton.textContent = date.getDate();

          // Check if date is from other month
          if (date.getMonth() !== currentDate.getMonth()) {
            dayButton.classList.add('other-month');
          }

          // Check if date is today
          if (date.getTime() === today.getTime()) {
            dayButton.classList.add('today');
          }

          // Check if date is selected
          if (selectedDate && date.getTime() === selectedDate.getTime()) {
            dayButton.classList.add('selected');
          }

          // Disable past dates
          if (date < today) {
            dayButton.classList.add('disabled');
          } else {
            dayButton.addEventListener('click', function () {
              selectDate(date);
            });
          }

          calendarDays.appendChild(dayButton);
        }

        // Update navigation buttons
        document.getElementById('prevMonth').disabled = false;
        document.getElementById('nextMonth').disabled = false;
      }

      function selectDate(date) {
        selectedDate = date;
        const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',
          'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        const formattedDate = `${monthNames[date.getMonth()]} ${date.getDate()}, ${date.getFullYear()}`;
        dateInput.value = formattedDate;
        calendarDropdown.classList.remove('show');
        updateCalendar();
      }

      // Initialize calendar
      initCalendar();

      // Create time select element if it doesn't exist
      if (!timeSelect) {
        const timeGroup = document.createElement('div');
        timeGroup.className = 'input-group';
        timeGroup.innerHTML = `
              <label for="time">Select Time:</label>
              <select id="time" required>
                  <option value="">Enter locations</option>
              </select>
          `;

        // Insert before the ETAY field
        const etayGroup = document.querySelector('label[for="ETAY"]').parentElement;
        etayGroup.parentNode.insertBefore(timeGroup, etayGroup);
      }

      // Function to check and update direction when locations change
      function checkAndUpdateDirection() {
        const pickup = pickupInput.value.trim();
        const dropoff = dropoffInput.value.trim();
        const timeSelect = document.getElementById('time');

        // Don't show loading if both fields are empty
        if (!pickup && !dropoff) {
          timeSelect.innerHTML = '<option value="">Enter locations</option>';
          return;
        }

        // Show loading only if both fields have some content
        if (pickup && dropoff) {
          timeSelect.innerHTML = '<option value="">Analyzing route...</option>';
          timeSelect.classList.add('loading');

          // Add a small delay to avoid premature validation
          setTimeout(() => {
            const direction = determineTripDirection(pickup, dropoff);

            if (direction) {
              updateTimeSelection(direction);
              timeSelect.classList.remove('loading');
              timeSelect.classList.add('success');
              console.log('Trip direction determined:', direction.directionText);
            } else {
              // Invalid route - show helpful message
              timeSelect.innerHTML = '<option value="">Invalid route - Please check locations</option>';
              timeSelect.classList.remove('loading');
              timeSelect.classList.remove('success');
              console.log('Invalid route detected');
            }
          }, 500); // 500ms delay to avoid premature validation
        } else {
          // Reset to initial state if either field is empty
          timeSelect.innerHTML = '<option value="">Enter locations</option>';
          timeSelect.classList.remove('loading', 'success');
        }
      }

      // Add event listeners for location changes with debouncing
      let timeoutId;
      function debouncedCheck() {
        clearTimeout(timeoutId);
        timeoutId = setTimeout(checkAndUpdateDirection, 500); // 500ms debounce
      }

      pickupInput.addEventListener('input', debouncedCheck);
      dropoffInput.addEventListener('input', debouncedCheck);

      // Also check on blur for immediate feedback
      pickupInput.addEventListener('blur', checkAndUpdateDirection);
      dropoffInput.addEventListener('blur', checkAndUpdateDirection);
    });

    function checkUser() {
      const user = JSON.parse(localStorage.getItem('user'));
      const userInfoElement = document.getElementById('userName');
      const logoutBtn = document.querySelector('.logout-btn');
      const userIcon = document.querySelector('.user-icon');

      if (user) {
        userInfoElement.textContent = `Welcome, ${user.fullName}`;
        logoutBtn.innerHTML = '<i class="fas fa-sign-out-alt"></i> Logout';
        logoutBtn.onclick = logout;
        userIcon.className = 'fas fa-user user-icon';
      } else {
        userInfoElement.textContent = '';
        logoutBtn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Login';
        logoutBtn.onclick = checkAuth;
        userIcon.className = 'fas fa-sign-in-alt user-icon';
      }
    }

    function toggleUserMenu() {
      const userInfo = document.querySelector('.user-info');
      userInfo.classList.toggle('mobile-active');
    }

    function checkAuth() {
      window.location.href = 'Login.html';
    }

    window.onload = function () {
      checkUser();
      initMap();
    };

    // Close mobile menu when clicking outside
    document.addEventListener('click', function (event) {
      const userInfo = document.querySelector('.user-info');
      const userIcon = document.querySelector('.user-icon');
      if (!userInfo.contains(event.target)) {
        userInfo.classList.remove('mobile-active');
      }
    });

    // Handle ETA label visibility
    document.addEventListener('DOMContentLoaded', function () {
      const etayInput = document.getElementById('ETAY');
      const etayLabel = document.querySelector('label[for="ETAY"]');

      if (etayInput && etayLabel) {
        // Hide label when input has a value and show the actual time
        function updateLabelVisibility() {
          if (etayInput.value) {
            etayLabel.style.display = 'none';
            // Ensure the input shows the selected time value
            etayInput.style.color = '#1B263B';
          } else {
            etayLabel.style.display = 'block';
            // Reset input color when empty
            etayInput.style.color = '#1B263B';
          }
        }

        // Check on load
        updateLabelVisibility();

        // Check on input change
        etayInput.addEventListener('input', updateLabelVisibility);
        etayInput.addEventListener('change', updateLabelVisibility);
        etayInput.addEventListener('focus', function () {
          // Hide label when input is focused
          etayLabel.style.display = 'none';
        });
        etayInput.addEventListener('blur', function () {
          // Show label only if input is empty when losing focus
          if (!etayInput.value) {
            etayLabel.style.display = 'block';
          }
        });
      }
    });
  </script>
</body>

</html>
