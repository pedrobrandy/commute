<!-- Common Header Component -->
<header class="common-header">
  <div class="header-content">
    <!-- Logo - Center -->
    <div class="logo-container">
      <!-- Logo desde GitHub Pages -->
      <a href="index.html" style="text-decoration: none; display: flex; align-items: center; justify-content: center;">
        <img src="../../public/image/commute-logo.png" alt="Commute Digital Logo" class="header-logo"
          onload="console.log('Logo cargado exitosamente')"
          onerror="console.log('Error cargando logo desde:', this.src); this.style.display='none'; this.nextElementSibling.style.display='block';" />
      </a>
    </div>

    <!-- User Menu - Right Side -->
    <div class="user-menu">
      <!-- Welcome Message - Next to menu -->
      <div class="welcome-container">
        <span id="welcome-message" class="welcome-text"></span>
      </div>

      <div class="user-menu-trigger">
        <img
          src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b2/Hamburger_icon.svg/1200px-Hamburger_icon.svg.png"
          alt="User Menu" class="user-menu-icon" />
      </div>
      <div class="user-menu-dropdown">
        <a href="javascript:void(0)" class="user-menu-item" id="login-logout-btn">
          <img src="https://cdn1.iconfinder.com/data/icons/heroicons-ui/24/user-512.png" alt="Login/Logout"
            class="menu-item-icon" />
          <span id="login-logout-text">Login</span>
        </a>
        <a href="My Rides.html" class="user-menu-item">
          <img src="https://static.thenounproject.com/png/210781-200.png" alt="My Rides" class="menu-item-icon" />
          <span>My Rides</span>
        </a>
      </div>
    </div>
  </div>
</header>

<style>
  /* Force header to be visible and properly positioned */
  .common-header {
    background-color: #1B263B !important;
    width: 100vw !important;
    padding: 8px 10px !important;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15) !important;
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    z-index: 9999 !important;
    display: block !important;
    visibility: visible !important;
    box-sizing: border-box !important;
    overflow: visible !important;
    transform: none !important;
  }

  .header-content {
    display: flex;
    align-items: center;
    justify-content: space-between;
    max-width: 1200px;
    margin: 0 auto;
    width: 100%;
    position: relative;
  }

  .logo-container {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .header-logo {
    height: 85px;
    width: auto;
    object-fit: contain;
    display: block;
    visibility: visible;
    opacity: 1;
  }

  /* Welcome Message Styles */
  .welcome-container {
    display: flex;
    align-items: center;
    margin-right: 15px;
  }

  .welcome-text {
    color: #E0E1DD;
    font-size: 14px;
    font-weight: 500;
    font-family: UberMove, UberMoveText, system-ui, "Helvetica Neue", Helvetica, Arial, sans-serif;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  /* User Menu Styles */
  .user-menu {
    position: relative;
    display: flex;
    align-items: center;
    margin-left: auto;
  }

  .user-menu-trigger {
    cursor: pointer;
    padding: 8px;
    border-radius: 50%;
    transition: background-color 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    background: none;
    border: none;
  }

  .user-menu-trigger:hover {
    background-color: rgba(255, 255, 255, 0.1);
  }

  .user-menu-icon {
    width: 32px;
    height: 32px;
    filter: brightness(0) saturate(100%) invert(93%) sepia(4%) saturate(360%) hue-rotate(161deg) brightness(97%) contrast(95%);
  }

  .user-menu-dropdown {
    position: absolute;
    top: 100%;
    right: 0;
    background: #E0E1DD;
    border: 1px solid #1B263B;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    min-width: 180px;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.3s ease;
    z-index: 1001;
    margin-top: 8px;
  }

  .user-menu:hover .user-menu-dropdown {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .user-menu-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
    color: #0D1B2A;
    text-decoration: none;
    transition: background-color 0.2s ease;
    border-bottom: 1px solid #E0E1DD;
    background: none;
    border: none;
    width: 100%;
    text-align: left;
    cursor: pointer;
    font-family: inherit;
    font-size: inherit;
  }

  .user-menu-item:last-child {
    border-bottom: none;
  }

  .user-menu-item:hover {
    background-color: rgba(119, 141, 169, 0.1);
    color: #0D1B2A;
  }

  .menu-item-icon {
    width: 30px;
    height: 30px;
    filter: brightness(0) saturate(100%) invert(47%) sepia(1%) saturate(1234%) hue-rotate(202deg) brightness(94%) contrast(89%);
  }

  .user-menu-item span {
    font-size: 14px;
    font-weight: 500;
  }

  @media (max-width: 600px) {
    .common-header {
      padding: 5px 10px;
      display: block !important;
      visibility: visible !important;
      opacity: 1 !important;
      width: 100vw !important;
      left: 0 !important;
      right: 0 !important;
      transform: none !important;
    }

    .header-content {
      width: 100% !important;
      max-width: none !important;
      padding: 0 5px;
    }

    .logo-container {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
    }

    .header-logo {
      height: 70px;
      display: block !important;
      visibility: visible !important;
      opacity: 1 !important;
      max-width: 100%;
    }

    .welcome-container {
      margin-right: 10px;
    }

    .welcome-text {
      font-size: 12px;
      margin-right: 241px;
      margin-top: 0px;
    }

    .user-menu {
      display: flex !important;
      visibility: visible !important;
      position: relative !important;
      right: 0 !important;
    }

    .user-menu-icon {
      width: 28px;
      height: 28px;
      display: block !important;
      visibility: visible !important;
    }

    .user-menu-dropdown {
      min-width: 160px;
      right: -10px;
    }

    .user-menu-item {
      padding: 10px 14px;
    }

    .menu-item-icon {
      width: 18px;
      height: 18px;
    }

    .user-menu-item span {
      font-size: 13px;
    }
  }
</style>

<script>
  // Simple login/logout function
  function handleLoginLogout() {
    console.log('=== handleLoginLogout called ===');
    console.log('localStorage user:', localStorage.getItem('user'));

    const isLoggedIn = localStorage.getItem('user') !== null;
    console.log('isLoggedIn:', isLoggedIn);

    if (isLoggedIn) {
      // User is logged in, perform logout
      console.log('User is logged in, performing logout...');
      localStorage.removeItem('user');
      localStorage.removeItem('tempPhone');
      console.log('localStorage cleared, redirecting to Login.html');
      window.location.href = 'Login.html';
    } else {
      // User is not logged in, redirect to login
      console.log('User is not logged in, redirecting to login...');
      window.location.href = 'Login.html';
    }
  }

  // Simple function to check if user is logged in
  function isUserLoggedIn() {
    return localStorage.getItem('user') !== null;
  }

  // Simple function to get current user
  function getCurrentUser() {
    const userStr = localStorage.getItem('user');
    if (userStr) {
      try {
        return JSON.parse(userStr);
      } catch (e) {
        console.error('Error parsing user data:', e);
        return null;
      }
    }
    return null;
  }

  // Function to update header based on authentication state
  function updateHeaderAuth() {
    console.log('=== updateHeaderAuth called ===');

    const user = getCurrentUser();
    const welcomeMessage = document.getElementById('welcome-message');
    const loginLogoutText = document.getElementById('login-logout-text');
    const loginLogoutBtn = document.getElementById('login-logout-btn');

    console.log('User data:', user);
    console.log('Elements found:', {
      welcomeMessage: !!welcomeMessage,
      loginLogoutText: !!loginLogoutText,
      loginLogoutBtn: !!loginLogoutBtn
    });

    if (!welcomeMessage || !loginLogoutText || !loginLogoutBtn) {
      console.error('Some header elements not found');
      return;
    }

    const menuItemIcon = loginLogoutBtn.querySelector('.menu-item-icon');

    if (user && user.fullName) {
      // User is logged in
      console.log('User is logged in, showing welcome message');
      welcomeMessage.textContent = `Welcome, ${user.fullName}`;
      loginLogoutText.textContent = 'Logout';
      if (menuItemIcon) {
        menuItemIcon.src = 'https://cdn1.iconfinder.com/data/icons/heroicons-ui/24/logout-512.png';
        menuItemIcon.alt = 'Logout';
      }
    } else {
      // User is not logged in
      console.log('User is not logged in, showing login button');
      welcomeMessage.textContent = '';
      loginLogoutText.textContent = 'Login';
      if (menuItemIcon) {
        menuItemIcon.src = 'https://cdn1.iconfinder.com/data/icons/heroicons-ui/24/user-512.png';
        menuItemIcon.alt = 'Login';
      }
    }
  }

  // Function to add event listener to login/logout button
  function addLoginLogoutListener() {
    const loginLogoutBtn = document.getElementById('login-logout-btn');

    if (loginLogoutBtn) {
      console.log('Adding event listener to login/logout button');
      loginLogoutBtn.addEventListener('click', function (e) {
        e.preventDefault();
        e.stopPropagation();
        console.log('Login/logout button clicked!');
        handleLoginLogout();
      });
    } else {
      console.log('Login/logout button not found, will retry...');
      // Retry after a short delay
      setTimeout(addLoginLogoutListener, 100);
    }
  }

  // Initialize when page loads
  function initializeHeader() {
    console.log('=== Initializing header ===');

    // Force header visibility
    const header = document.querySelector('.common-header');
    if (header) {
      header.style.display = 'block';
      header.style.visibility = 'visible';
      header.style.opacity = '1';
      header.style.position = 'fixed';
      header.style.top = '0';
      header.style.left = '0';
      header.style.right = '0';
      header.style.width = '100vw';
      header.style.zIndex = '9999';
    }

    // Update authentication state
    updateHeaderAuth();

    // Add event listener to login/logout button
    addLoginLogoutListener();
  }

  // Run initialization
  console.log('=== Header script starting ===');

  // Try to initialize immediately
  initializeHeader();

  // Also try on DOMContentLoaded
  document.addEventListener('DOMContentLoaded', function () {
    console.log('=== DOMContentLoaded event ===');
    initializeHeader();
  });

  // Also try on window load
  window.addEventListener('load', function () {
    console.log('=== Window load event ===');
    updateHeaderAuth();
    addLoginLogoutListener();
  });

  // Also try after a delay to ensure dynamic content is loaded
  setTimeout(function () {
    console.log('=== Delayed initialization ===');
    updateHeaderAuth();
    addLoginLogoutListener();
  }, 1000);

  console.log('=== Header script loaded ===');
</script>
